<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Dean Attali" />

<meta name="date" content="2015-01-15" />

<title>spinMyR</title>




<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">spinMyR</h1>
<h4 class="author"><em>Dean Attali</em></h4>
<h4 class="date"><em>2015-01-15</em></h4>
</div>


<div id="spinmyr-create-markdownhtml-reports-from-r-scripts-with-no-hassle" class="section level2">
<h2><code>spinMyR()</code>: create markdown/HTML reports from R scripts with no hassle</h2>
<p><code>spinMyR()</code> is an improvement on <code>knitr::spin</code> that adds flexibility in several ways. <code>spin</code> alone is great when all you need to do is convert a one-off R script to markdown/HTML and everything lives in the same directory. But if you’ve ever tried using <code>spin</code> on an R script and got confused about working directories, tried changing the output location, or wanted to run the same script multiple times but with slightly different parameters/datasets without having to change all your code, you will love <code>spinMyR</code>.</p>
<p><code>spinMyR</code> is a recommended wrapper to <code>spin</code> when any of the following are true:</p>
<ul>
<li><strong>The R script requires a certain working directory that is <em>not</em> the directory in which the script lives</strong> (<code>spin</code> assumes that the working directory for thec code in the script is the directory where the script is, which means that all that paths in the code must change if you are running the script manually vs using <code>spin</code>)<br /></li>
<li><strong>The results should be produced in a different directory</strong> (with <code>spin</code>, the output will be produced in the directory that the user makes the call from)<br /></li>
<li><strong>The script has one or more parameters</strong> (and you want to run an identical script multiple times with different parameters/datasets)</li>
</ul>
<p>Many real-life data analysis scenarios will use all these features, as illustrated with the examples below. There are several other features that are documented in <code>?rsalad::spinMyR</code>.</p>
<div id="example-basic-use-case-and-motivation" class="section level3">
<h3>Example: basic use case and motivation</h3>
<p><code>spinMyR</code> can come in very handy when writing a script that can be used to analyze a certain type of data, and you want to be able to easily run the script on different datasets.</p>
<p>Assume we have an R script that reads a data file and produces a short report while also generating a figure. Native <code>spin</code> works great if you have a flat directory structure like this (assume the working directory is inside <code>project</code>):</p>
<pre><code>- project
  |- subproject
     |- input.csv
     |- script.R</code></pre>
<p>After running <code>spin</code>, the resulting directory structure would look like this:</p>
<pre><code>spin(&quot;subproject/script.R&quot;)

- project
   |- subproject
     |- markdown-figs
        |- fig1.png
     |- input.csv
     |- script.R
   |- script.Rmd
   |- script.md
   |- script.html</code></pre>
<p>Notice that the outputs are produced in the directory where the function called from, completely separated from where the input script is.</p>
<p>But in a real project, you rarely have everything just lying around in the same folder. Here is an example of a more realistic initial directory structure:</p>
<pre><code>- project
   |- subproject
     |- data
        |- input.csv
     |- R
        |- script.R</code></pre>
<p>Now if we want <code>knitr::spin</code> to work, the path to <code>input.csv</code> would have to be relative to the <code>R</code> directory. But if we want to <code>source</code> the file or run it manually, the paths have to be relative to our working directory (<code>project</code>). This means that we can’t use the exact same code to source the file vs <code>spin</code>-ing the file. A similar problem arrises if you want to create files from the R script (<code>spin</code> will assume the working directory of the code is where the code lives, rather than what the project working directory is).<br />Another problem with the flat directory structure is that you may want to controlr where the esulting markdown/HTML reports get generated. <code>spin</code> will create all the outputs in the working directory of the user (as far as I know, you cannot control that behaviour).</p>
<p><code>spinMyR</code> fixes all these issues, and more. Assuming we are currently in the <code>project</code> directory, we could use the following command to generate an appropriate tree structure:</p>
<pre><code>spinMyR(file = file.path(&quot;R&quot;, &quot;script.R&quot;), wd = &quot;subproject&quot;,
        outDir = &quot;reports&quot;, figDir = &quot;myfigs&quot;)

- project
  |- subproject
     |- data
        |- input.csv
     |- R
        |- script.R
     |- reports
        |- myfigs
           |- fig1.png
        |- script.Rmd
        |- script.md
        |- script.HTML</code></pre>
<p>This non-basic directory structure simply is not achievable with basic <code>spin</code> unfortunately, which is why <code>spinMyR</code> was created.</p>
</div>
<div id="example-using-one-script-to-analyze-different-datasets" class="section level3">
<h3>Example: using one script to analyze different datasets</h3>
<p>One particular case when this kind of directory structure makes sense is when you have different datasets and different analysis scripts, and you want to be able to run each analysis on each dataset and keep the results organized. I was involved in a few projects that required me to adopt that kind of organization, and <code>spinMyR</code> was developed especially for this use. Imagine having a project structured like this:</p>
<pre><code>- project
   |- data
      |- human.dat
      |- mouse.dat
   |- R
      |- explore.R
      |- analyze.R</code></pre>
<p>We can easily use <code>spinMyR</code> to run any of the analysis scripts on any of the datasets. Let’s assume that each analysis script expects there to be a variable named <code>DATASET_NAME</code> that tells the script what data to operate on. The following <code>spinMyR</code> commands illustrate how they can be used to achieve this structure.</p>
<pre><code>spinMyR(file = &quot;R/explore.R&quot;, outDir = &quot;reportS/human&quot;,
        params = list(&quot;DATASET_NAME&quot; = &quot;human.dat&quot;))
spinMyR(file = &quot;R/explore.R&quot;, outDir = &quot;reports/mouse&quot;,
        params = list(&quot;DATASET_NAME&quot; = &quot;mouse.dat&quot;))
spinMyR(file = &quot;R/analyze.R&quot;, outDir = &quot;reports/mouse&quot;,
        params = list(&quot;DATASET_NAME&quot; = &quot;mouse.dat&quot;))

- project
   |- data
      |- human.dat
      |- mouse.dat
   |- R
      |- explore.R
      |- analyze.R
   |- reports
      |- human
         |- explore.R
      |- mouse
         |- analyze.R
         |- explore.R</code></pre>
<p>A few things to note:</p>
<ul>
<li>With <code>spinMyR</code>, the working directory of the code in the script is by default set to be the working directory of the user, rather than the script’s directory<br /></li>
<li>The output directory by default is the same as the input directory<br /></li>
<li>The figures directory is set to be relative to the output (trust me when I say that setting this automatically will save you hours of battling with directories)<br /></li>
<li><code>spinMyR</code> accepts both relative and absolute file paths<br /></li>
<li>This example uses the <code>params = list()</code> argument, which lets you pass variables to the R script. In this case, I use it to tell the script what dataset to use, and the script assumes a <code>DATASET_NAME</code> variable exists. This of course means that the analysis script has an external dependency by having a variable that is not populated by the script. Some may argue that it’s bad form, but I think this is a fairly clean solution. Moreover, you can always use a default value for variables in your script by having code such as<br /><code>DATASET_NAME &lt;- ifelse(exists(&quot;DATASET_NAME&quot;), DATASET_NAME, &quot;default_data&quot;)</code></li>
</ul>
</div>
<div id="live-example" class="section level3">
<h3>Live example</h3>
<p>To try out the differences between <code>knitr::spin</code> and <code>rsalad::spinMyR</code>, I have added a function to the <code>rsalad</code> package that will set up a directory with an R script and a data file so that you can experiment with both functions to see the differences. See <code>?rsalad::setupSpinMyRtest</code> for more information and to see some simple testing commands.</p>
</div>
<div id="spin-vs-knit" class="section level3">
<h3><code>spin</code> vs <code>knit</code></h3>
<p>If you’re asking why even bother with <code>spin</code> because you always create <code>.Rmd</code> files, then read this section. Disclaimer: I may have a simplistic and non-comprehensive view on <code>spin</code>, but this is why I use it.</p>
<p>A common approach useRs can take to producing an R markdown document is as follows:<br />1. Write a bunch of interactive statements in an <code>.R</code> script<br />2. Once all the R code is in place, polish the code to make sure it runs smoothly when <code>source</code>d<br />3. Copy the code to a new <code>.Rmd</code> file, add formatting and surround code in code chunks<br />4. You now have duplicated your whole analysis. If you want to change a variable, you must change it in both the <code>.R</code> and the <code>.Rmd</code>.</p>
<p>Instead of steps 3 and 4, you can just add the formatting and code chunks to the original R script (with <code>#'</code> and <code>#+</code>), so that you still have all your code in one place. Having to manage only one R script as opposed to an R script and an Rmarkdown makes my life much simpler. As a bonus, I also find it much faster to convert R to Rmarkdown like this because each code chunk only has to be defined in one place (<code>#+</code>) rather than in two place (<code>```{r}</code> before and <code>```</code> after).</p>
</div>
<div id="more-information" class="section level3">
<h3>More information</h3>
<p>To use <code>spinMyR</code>, install <code>rsalad</code> using <code>devtools::install_github(&quot;daattali/rsalad&quot;)</code> and run <code>spinMyR</code> with <code>rsalad::spinMyR()</code>.</p>
<p>For more information including all features and parameters supported, see <code>?rsalad::spinMyR</code>.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
